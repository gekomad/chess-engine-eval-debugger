<!doctype html>
<!-- http://127.0.0.1:8080/index.html?exe1=stockfish&exe2=crafty&proto1=uci&proto2=xboard&eval1=eval&eval2=score&rem1=0&rem2=4 -->
<html>
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Chess engine eval debugger</title>
      <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon" />
      <link rel="stylesheet" href="css/normalize-2.1.2.min.css" />
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" />
      <link rel="stylesheet" href="css/site2.css" />
      <link rel="stylesheet" href="css/chessboard.css" />
      <style>
         * {
         box-sizing: border-box;
         }
         /* Create two equal columns that floats next to each other */
         .column {
         float: left;
         width: 50%;
         padding: 10px;
         height: 300px; /* Should be removed. Only for demonstration */
         }
         /* Clear floats after the columns */
         .row:after {
         content: "";
         display: table;
         clear: both;
         }
      </style>
   </head>
   <body>
      <div class="row">
         <div class="column" style="background-color:#aaa;">
            <div class="column" style="background-color:#aaa;">
               <div id="board" style="width: 230px"></div>
            </div>
            <input type="checkbox" id="castle_K" checked>White can castle kingside<br>
            <input type="checkbox" id="castle_k" checked>Black can castle kingside<br>
            <input type="checkbox" id="castle_Q" checked>White can castle queenside<br>
            <input type="checkbox" id="castle_q" checked>Black can castle queenside<br>
            <input type="checkbox" id="black_to_move" >Black to move<br>
            <input type="button" id="startBtn" value="Start" />
            <input type="button" id="clearBtn" value="Clear" />
         </div>
         <div class="column" style="background-color:#bbb;">
            <h2>Engines</h2>
            <label for="engine1">engine 1</label>
            <div class="row">
               <label for="exe1">exe:</label><input title="example: c:\stockfish.exe"  type="text" id="exe1">
               <label for="eval_command1">eval command:</label><input type="text" title="example: eval" id="eval_command1" value="eval">
               <label for="protocol1">protocol1:</label>
               <select id="protocol1">
                  <option value="uci">uci</option>
                  <option value="xboard">xboard</option>
               </select>
               <label for="avatar">remove line:</label>
               <select id="remove_line1">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
               </select>
            </div>
            <label for="engine2">engine 2</label>
            <div class="row">
               <label for="exe2">exe:</label><input "example: c:\crafty.exe" type="text" id="exe2"">
               <label for="eval_command2">eval command:</label><input type="text" title="example: score" id="eval_command2" value="score">
               <label for="protocol2">protocol:</label>
               <select id="protocol2">
                  <option value="uci">uci</option>
                  <option value="xboard">xboard</option>
               </select>
               <label for="avatar">remove line:</label>
               <select id="remove_line2">
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
               </select>
            </div>
         </div>
      </div>
      <div class="row">
         <div class="column" style="background-color:#aaa;">
            <p><input type="text"  style="background-color:#aaa; border: none;" readonly size="100%" id="text_fen"  value="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1"></p>
            <textarea id="writeArea1" rows="25"  style="background-color:#6984a3;" cols="100%" readonly>eng1 evaluation</textarea>
         </div>
         <div class="column" style="background-color:#bbb;">
            <p>_</p>
            <textarea id="writeArea2" rows="25" style="background-color:#88aac2;" cols="100%" readonly>eng2 evaluation</textarea>
         </div>
      </div>
      </div>
      <script src="js/json3.min.js"></script>
      <script src="js/jquery-1.10.1.min.js"></script>
      <script src="js/prettify.js"></script>
      <script src="js/chessboard.js"></script>
      <script>
         $.urlParam = function(name){
             var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
             if (results==null) {
                return null;
             }
             return decodeURI(results[1]) || 0;
         }
                  $('#exe1').val($.urlParam('exe1'))
                  $('#exe2').val($.urlParam('exe2'))
                  if($.urlParam('proto1')!=null)$('#protocol1').val($.urlParam('proto1'))
                  if($.urlParam('proto2')!=null)$('#protocol2').val($.urlParam('proto2'))
                  $('#eval_command1').val($.urlParam('eval1'))
                  $('#eval_command2').val($.urlParam('eval2'))
                  if($.urlParam('rem1')!=null)$('#remove_line1').val($.urlParam('rem1'))
                  if($.urlParam('rem2')!=null)$('#remove_line2').val($.urlParam('rem2'))
               var onDrop = function(source, target, piece, newPos, oldPos, orientation) {
                  var side_to_move='w'
                  var castle=''
                  if($("#black_to_move").prop('checked')){
                   side_to_move='b'
                  }
                  if($("#castle_K").prop('checked')){
                   castle=castle+'K'
                  }
                  if($("#castle_Q").prop('checked')){
                   castle=castle+'Q'
                  }
                  if($("#castle_k").prop('checked')){
                   castle=castle+'k'
                  }
                  if($("#castle_q").prop('checked')){
                   castle=castle+'q'
                  }
                  if(castle==''){
                   castle='-'
                  }
                  fen_complete= ChessBoard.objToFen(newPos) +" "+side_to_move+" "+castle +" - 0 1"
                  
                  $('#text_fen').val(fen_complete);
                    if($("#exe1").val()!=""){
                  $.ajax({
                      type: 'POST',
                      url: 'json.server.py',
                      data: '{"fen":"'+fen_complete+'","exe":"'+$("#exe1").val()+'","eval_command":"'+$("#eval_command1").val()+'","protocol":"'+$("#protocol1").val()+'","remove_line":"'+$("#remove_line1").val()+'"}',    
                      contentType: "application/json",
                      dataType: 'json',
                      success: function(msg) {
                              $('#writeArea1').val(msg.responseText);
                              return data;
                          },
                  
                      error: function(msg) {
                              $('#writeArea1').val(msg.responseText);
                          }
                  }); }else {$('#writeArea1').val("first engine not selected");}
                  if($("#exe2").val()!=""){
                  $.ajax({
                      type: 'POST',
                      url: 'json.server.py',
                      data: '{"fen":"'+fen_complete+'","exe":"'+$("#exe2").val()+'","eval_command":"'+$("#eval_command2").val()+'","protocol":"'+$("#protocol2").val()+'","remove_line":"'+$("#remove_line2").val()+'"}',    
                      contentType: "application/json",
                      dataType: 'json',
                      success: function(msg) {
                              $('#writeArea2').val(msg.responseText);
                              return data;
                          },
                  
                      error: function(msg) {
                              $('#writeArea2').val(msg.responseText);
                          }
                  });
                  }else {$('#writeArea2').val("second engine not selected");}
                  };
                  
                  var cfg = {
                    draggable: true,
                    position: 'start',
                    dropOffBoard: 'trash',
                    onDrop: onDrop,
                    sparePieces: true
                  };
                  var board = ChessBoard('board', cfg);
                  
             
                  $('#startBtn').on('click', function() {
                    document.getElementById("castle_K").checked = true;
                    document.getElementById("castle_k").checked = true;
                    document.getElementById("castle_Q").checked = true;
                    document.getElementById("castle_q").checked = true;
                    document.getElementById("black_to_move").checked = false;         
                    board.start()
                    }
                );
                  $('#clearBtn').on('click', function() {
                    document.getElementById("castle_K").checked = false;
                    document.getElementById("castle_k").checked = false;
                    document.getElementById("castle_Q").checked = false;
                    document.getElementById("castle_q").checked = false;
                    board.clear()
                    }
                );
                  
               
      </script>   
   </body>
</html>
